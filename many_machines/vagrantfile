mach_quant = 3


if mach_quant>253 && mach_quant<1 then
    puts "wrong number"
else
    Vagrant.configure("2") do |config|

        config.vm.provider "virtualbox" do |vb|
            vb.gui = false
            vb.memory=256
            vb.cpus=1
            vb.check_guest_additions=false
        config.vm.box_check_update=false
        config.vm.box="ubuntu/trusty64"

        config.vm.provision "shell", inline: $script

    end

    (1..$mach_quant).each do |i|
        config.vm.define "node#{i}" do |node|
            node.vm.network "public_network", ip: "192.168.1.#{i}"
            node.vm.hostname = "node#{i}"
            if i==1
                node.vm.provision "shell",
                    inline: "sudo apt install nginx"
            else
                node.vm.provision "shell",
                inline: "sudo apt install tomcat9 tomcat9-admin"
                node.vm.provision "shell",
                inline: "sudo ufw allow from any to any port 8080 proto tcp"
                node.vm.provision "shell",
                inline: "cd /usr/local/tomcat9/webapps/ROOT"
                node.vm.provision "shell",
                inline: "touch index.html"
                node.vm.provision "shell",
                inline: "echo 'Hi! This is computer number #{i} with ip 192.168.1.#{i}' > index.html"
                node.vm.provision "shell",
                inline: "sudo systemctl enable tomcat"
            end
        end

    end

    (1..$mach_quant).each do |i|
        config.vm.define "node#{i}" do |node|
            node.vm.provision "shell", inline: "echo '192.168.1.#{i}    ubuntu#{i}' > /etc/hosts"
        end
    end
end
end